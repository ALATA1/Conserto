pipeline {
    agent any

    environment {
        // Remplace ce chemin par celui de ton installation Python si nécessaire en 
        // enxécutant ces lignes de commandes : 
        // python --version  
        // pip --version
        // where python
        // where pip
        PYTHON = 'C:\\Users\\ibrahima.alata\\AppData\\Local\\Programs\\Python\\Python313\\python.exe'
        // PYTHON = 'C:\\Users\\ibrahima.alata\\AppData\\Local\\Microsoft\\WindowsApps\\python.exe'
        // PYTHON = 'C:\\Users\\ibrahima.alata\\AppData\\Local\\Programs\\Python\\Python313\\Scripts\\pip.exe'
    }

    stages {
        stage('Installation des dépendances') {
            steps {
                echo 'Installation des librairies nécessaires'
                bat "${env.PYTHON} -m pip install --upgrade pip"
                bat "${env.PYTHON} -m pip install -r requirements.txt"
            }
        }

        stage('Exécution des tests Robot Framework') {
            steps {
                echo 'Lancement des tests'
                bat "${env.PYTHON} -m robot --outputdir Resultats Tests"
            }
        }

        stage('Archivage des résultats') {
            steps {
                echo 'Archivage des fichiers de test'
                archiveArtifacts artifacts: 'Resultats/**/*.*', allowEmptyArchive: true
            }
        }

        stage('Rapport Robot Framework (si plugin installé)') {
            steps {
                // Nécessite le plugin Robot Framework dans Jenkins
                // robot outputPath: 'Resultats'
                echo 'robot outputPath '
                
            }
        }
    }

    post {
        always {
            echo 'Pipeline terminé.'
        }
    }
}
